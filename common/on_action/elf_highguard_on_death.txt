# character just about to die in root scope
# if a killer is known, it's set as scope:killer
#Triggered by code

on_death = {
    on_actions = {
        elf_highguard_pillage
    }
}

elf_highguard_pillage = {
    # EP3 - Highguard Palace Pillaging
    effect = {
        if = {
            limit = {
                primary_title = title:e_byzantium
                OR = {
                    "number_maa_regiments_of_type(highguard)" >= 1
                    number_title_maa_regiments_of_type = {
                        target = highguard
                        value >= 1
                    }
                    any_court_position_holder = {
                        type = eryndar_court_position
                        highguardian_trigger = yes
                    }
                }
            }
            save_scope_as = dead_emperor
            if = {
                limit = {
                    number_maa_soldiers_of_type = {
                        target = highguard
                        value > 0
                        value <= 100
                    }
                }
                primary_heir = {
                    set_variable = {
                        name = highguardian_regiments
                        value = 1
                    }
                }
            }
            else_if = {
                limit = {
                    number_maa_soldiers_of_type = {
                        target = highguard
                        value > 100
                        value <= 200
                    }
                }
                primary_heir = {
                    set_variable = {
                        name = highguardian_regiments
                        value = 2
                    }
                }
            }
            else_if = {
                limit = {
                    number_maa_soldiers_of_type = {
                        target = highguard
                        value > 200
                        value <= 300
                    }
                }
                primary_heir = {
                    set_variable = {
                        name = highguardian_regiments
                        value = 3
                    }
                }
            }
            else_if = {
                limit = {
                    number_maa_soldiers_of_type = {
                        target = highguard
                        value > 300
                        value <= 400
                    }
                }
                primary_heir = {
                    set_variable = {
                        name = highguardian_regiments
                        value = 4
                    }
                }
            }
            else_if = {
                limit = {
                    number_maa_soldiers_of_type = {
                        target = highguard
                        value > 400
                        value <= 500
                    }
                }
                primary_heir = {
                    set_variable = {
                        name = highguardian_regiments
                        value = 5
                    }
                }
            }
            else_if = {
                limit = {
                    number_maa_soldiers_of_type = {
                        target = highguard
                        value > 500
                        value <= 600
                    }
                }
                primary_heir = {
                    set_variable = {
                        name = highguardian_regiments
                        value = 6
                    }
                }
            }
            else_if = {
                limit = {
                    number_maa_soldiers_of_type = {
                        target = highguard
                        value > 600
                        value <= 700
                    }
                }
                primary_heir = {
                    set_variable = {
                        name = highguardian_regiments
                        value = 7
                    }
                }
            }
            else_if = {
                limit = {
                    number_maa_soldiers_of_type = {
                        target = highguard
                        value > 700
                        value <= 800
                    }
                }
                primary_heir = {
                    set_variable = {
                        name = highguardian_regiments
                        value = 8
                    }
                }
            }
            else_if = {
                limit = {
                    number_maa_soldiers_of_type = {
                        target = highguard
                        value > 800
                        value <= 900
                    }
                }
                primary_heir = {
                    set_variable = {
                        name = highguardian_regiments
                        value = 9
                    }
                }
            }
            else = {
                primary_heir = {
                    set_variable = {
                        name = highguardian_regiments
                        value = 10
                    }
                }
            }
            primary_heir = {
                trigger_event = {
                    id = romaviri_emperor_yearly.3000
                    days = { 10 20 }
                }
            }
        }
    }
}