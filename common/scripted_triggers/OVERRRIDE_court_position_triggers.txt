# Grants a random unfilled court position based on skills and traits using CANDIDATE - ROOT is ruler
any_court_position_available_trigger = {
	OR = {
		NOT = { employs_court_position = royal_architect_court_position }
		NOT = { employs_court_position = seneschal_court_position }
		NOT = { employs_court_position = court_tutor_court_position }
		NOT = { employs_court_position = court_guru_court_position }
		NOT = { employs_court_position = high_almoner_court_position }
		NOT = { employs_court_position = court_physician_court_position }
		NOT = { employs_court_position = antiquarian_court_position }
		NOT = { employs_court_position = master_of_horse_court_position }
		AND = {
			$CANDIDATE$ = {
				can_be_combatant_based_on_gender_trigger = { ARMY_OWNER = ROOT }
			}
			NOT = { employs_court_position = bodyguard_court_position }
		}
		AND = {
			$CANDIDATE$ = {
				can_be_combatant_based_on_gender_trigger = { ARMY_OWNER = ROOT }
			}
			NOT = { employs_court_position = champion_court_position }
		}
		NOT = { employs_court_position = master_of_hunt_court_position }
		NOT = { employs_court_position = court_poet_court_position }
		NOT = { employs_court_position = court_musician_court_position }
		NOT = { employs_court_position = cupbearer_court_position }
		AND = {
			is_female = yes
			$CANDIDATE$ = { is_female = yes }
			NOT = { employs_court_position = lady_in_waiting_court_position }
		}
		AND = {
			culture = { has_cultural_parameter = can_appoint_chief_eunuch }
			$CANDIDATE$ = { is_eunuch_trigger = yes }
			NOT = { employs_court_position = chief_eunuch_court_position }
		}
		AND = {
			culture = { has_cultural_parameter = can_appoint_court_gardener }
			NOT = { employs_court_position = court_gardener_court_position }
		}
		AND = {
			$CANDIDATE$ = {
				can_be_combatant_based_on_gender_trigger = { ARMY_OWNER = ROOT }
			}
			NOT = { employs_court_position = akolouthos_court_position }
		}
		AND = {
			$CANDIDATE$ = {
				can_be_combatant_based_on_gender_trigger = { ARMY_OWNER = ROOT }
			}
			NOT = { employs_court_position = eryndar_court_position }
		}
		AND = {
			government_has_flag = government_is_nomadic
			OR = {
				has_religion = religion:tengrism_religion
				culture = { has_cultural_pillar = heritage_mongolic }
				culture = { has_cultural_pillar = heritage_turkic }
			}
			NOT = { employs_court_position = court_astrologer_court_position }
		}
		AND = {
			government_has_flag = government_is_nomadic
			NOT = { employs_court_position = boyan_court_position }
		}
		AND = {
			has_trait = military_engineer
			NOT = { employs_court_position = siege_engineer_court_position }
		}
		AND = {
			government_has_flag = government_is_nomadic
			NOT = { employs_court_position = yurtchi_court_position }
		}
		AND = {
			government_has_flag = government_is_nomadic
			NOT = { employs_court_position = cherbi_court_position }
		}
		AND = {
			government_has_flag = government_is_nomadic
			NOT = { employs_court_position = yeke_jarquchi_court_position }
		}
		AND = {
			NOT = { root.culture = $CANDIDATE$.culture }
			NOT = { employs_court_position = foreign_emissary_court_position }
		}
		AND = {
			government_has_flag = government_is_nomadic
			NOT = { employs_court_position = keeper_of_the_horses_court_position }
		}
	}
}

#@info! Used together with assign_appropriate_court_position_effect and distribute_determined_court_position_effect -- update the flags here if you add any Court Positions in the effects
has_any_court_position_flag_trigger = {
	OR = {
		has_character_flag = physician_flag
		has_character_flag = tutor_flag
		has_character_flag = almoner_flag
		has_character_flag = antiquarian_flag
		has_character_flag = qadi_flag
		has_character_flag = taster_flag
		has_character_flag = executioner_flag
		has_character_flag = cupbearer_flag
		has_character_flag = lady_in_waiting_flag
		has_character_flag = jester_flag
		has_character_flag = poet_flag
		has_character_flag = musician_flag
		has_character_flag = gardener_flag
		has_character_flag = architect_flag
		has_character_flag = swan_flag
		has_character_flag = seneschal_flag
		has_character_flag = horse_flag
		has_character_flag = garuda_flag
		has_character_flag = hunt_flag
		has_character_flag = bodyguard_flag
		has_character_flag = travel_leader_flag
		has_character_flag = wet_nurse_flag
		has_character_flag = akolouthos_flag
		has_character_flag = eryndar_flag
		has_character_flag = court_astrologer_flag
		has_character_flag = boyan_flag
		has_character_flag = siege_engineer_flag
		has_character_flag = yurtchi_flag
		has_character_flag = yeke_jarquchi_flag
		has_character_flag = foreign_emissary_flag
		has_character_flag = keeper_of_the_horses_flag
	}
}

# Used in the trigger for court positions to make sure that they don't already have a "job"
# If a court position is considered a full time job, the character cannot hold another similar position
court_position_does_not_already_have_a_job_trigger = {
	custom_tooltip = {
		text = does_not_have_a_full_time_job
		NOR = {
			has_court_position = court_tutor_court_position
			has_court_position = court_guru_court_position
			has_court_position = food_taster_court_position
			has_court_position = seneschal_court_position
			has_court_position = cupbearer_court_position
			has_court_position = antiquarian_court_position
			has_court_position = lady_in_waiting_court_position
			has_court_position = court_jester_court_position
			has_court_position = court_poet_court_position
			has_court_position = court_musician_court_position
			has_court_position = bodyguard_court_position
			has_court_position = executioner_court_position
			has_court_position = court_gardener_court_position
			has_court_position = travel_leader_court_position
			has_court_position = wet_nurse_court_position
			has_court_position = akolouthos_court_position
			has_court_position = eryndar_court_position
			has_court_position = grand_preceptor_court_position
			has_court_position = grand_guardian_court_position
			has_court_position = grand_mentor_court_position
			has_court_position = fire_dragon_engineer_court_position
			has_court_position = keeper_of_the_harem_court_position
			is_councillor = yes
		}
	}
}

# IMPORTANT: This should be used before most instances of appoint_court_position - CU
# Checks that you can employ a specific character to a specific court position at a given moment. This prevents errors from randomly trying to already hire the holder of that court position in some cases.
# Trigger should be used in the scope of the hiring liege
# $COURT_POS$ is the position to which you want to appoint a character
# $CHAR$ is the character you wish to appoint

can_appoint_char_to_any_court_position = {
	OR = {
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = court_physician_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = cultural_emissary_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = keeper_of_swans_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = chief_qadi_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = garuda_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = court_gardener_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = lady_in_waiting_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = antiquarian_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = travel_leader_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = wet_nurse_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = court_tutor_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = court_guru_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = food_taster_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = master_of_horse_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = master_of_hunt_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = royal_architect_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = high_almoner_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = seneschal_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = cupbearer_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = chief_eunuch_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = court_jester_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = court_poet_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = court_musician_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = bodyguard_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = champion_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = executioner_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = court_artificer_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = master_assassin_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = cave_hermit_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = chronicler_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = court_scholar_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = charioteer_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = bookmaker_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = akolouthos_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = eryndar_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = court_brewmaster_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = court_astrologer_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = boyan_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = siege_engineer_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = yurtchi_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = cherbi_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = yeke_jarquchi_court_position }
		can_appoint_char_to_court_position = { CHAR = $CHAR$ COURT_POS = keeper_of_the_horses_court_position }
	}
}

has_martial_court_position = {
	OR = {
		has_court_position = master_of_horse_court_position
		has_court_position = bodyguard_court_position
		has_court_position = champion_court_position
		has_court_position = master_of_hunt_court_position
		has_court_position = akolouthos_court_position
		has_court_position = eryndar_court_position
		has_court_position = boyan_court_position
		has_court_position = siege_engineer_court_position
		has_court_position = cherbi_court_position
		has_court_position = keeper_of_the_horses_court_position
	}
}

eryndar_validity_trigger = {
	base_court_position_validity_trigger = { EMPLOYER = $EMPLOYER$ }
	is_landed = no
	can_be_combatant_based_on_gender_trigger = { ARMY_OWNER = $EMPLOYER$ } # check culture of warrior not liege
	custom_tooltip = {
		text = NONE_NOT_THE_SPOUSE_OF_CHARACTER_COURT_POSITION
		NOT = { is_spouse_of = $EMPLOYER$ }
	}
	OR = {
		culture = {
			OR = {
				custom_tooltip = {
					text = court_position_astrion_elemental
					has_cultural_tradition = tradition_astrion_elemental_mastery
				}
				custom_tooltip = {
					text = court_position_astrion_magic
					has_cultural_tradition = tradition_astrion_magic_engineering
				}
				custom_tooltip = {
					text = court_position_astrion_alchemy
					has_cultural_tradition = tradition_astrion_alchemical_aptitude
				}
				custom_tooltip = {
					text = court_position_alfar_homeland
					has_cultural_tradition = tradition_alfar_homeland_defense
				}
				custom_tooltip = {
					text = court_position_alfar_union
					has_cultural_tradition = tradition_alfar_union_of_elves
				}
				custom_tooltip = {
					text = court_position_alfar_battlefiends
					has_cultural_tradition = tradition_alfar_battlefiends
				}
				custom_tooltip = {
					text = court_position_deepwood_foresters
					has_cultural_tradition = tradition_deepwood_foresters
				}
				custom_tooltip = {
					text = court_position_deepwood_terraforming
					has_cultural_tradition = tradition_deepwood_terraforming
				}
				custom_tooltip = {
					text = court_position_deepwood_guest_rites
					has_cultural_tradition = tradition_deepwood_guest_rites
				}
				custom_tooltip = {
					text = court_position_atlareth_coastal
					has_cultural_tradition = tradition_atlareth_coastal_mastery
				}
				custom_tooltip = {
					text = court_position_atlareth_raiding
					has_cultural_tradition = tradition_atlareth_raiding_expertise
				}
				custom_tooltip = {
					text = court_position_atlareth_glory
					has_cultural_tradition = tradition_atlareth_glory_seeking
				}
				custom_tooltip = {
					text = court_position_romaviri_strategy
					has_cultural_tradition = tradition_romaviri_strategy
				}
				custom_tooltip = {
					text = court_position_romaviri_affluence
					has_cultural_tradition = tradition_romaviri_affluence
				}
				custom_tooltip = {
					text = court_position_romaviri_bureaucracy
					has_cultural_tradition = tradition_romaviri_bureaucracy
				}
				custom_tooltip = {
					text = court_position_tuathan_resilience
					has_cultural_tradition = tradition_tuathan_resilience
				}
				custom_tooltip = {
					text = court_position_tuathan_prosperity
					has_cultural_tradition = tradition_tuathan_prosperity
				}
				custom_tooltip = {
					text = court_position_tuathan_brain
					has_cultural_tradition = tradition_tuathan_brain_and_brawn
				}
				custom_tooltip = {
					text = court_position_elf
					has_cultural_pillar = heritage_elf
				}
			}
		}
		AND = {
			has_trait = loyal
			culture = {
				NOR = {
					custom_tooltip = {
						text = court_position_not_same_culture_heritage
						has_same_culture_heritage = $EMPLOYER$.culture
					}
					custom_tooltip = {
						text = court_position_not_same_culture_language
						has_same_culture_language = $EMPLOYER$.culture
					}
				}
			}
		}
	}
	custom_tooltip = {
		text = none_does_not_have_a_full_time_job
		trigger_if = {
			limit = { NOT = { has_court_position = eryndar_court_position } }
			court_position_does_not_already_have_a_job_trigger = yes # This positions is considered a job, and cannot be held at the same time as another similar position
		}
	}
}

can_be_employed_as_any_court_position_trigger = {
	OR = {
		can_be_employed_as = court_poet_court_position
		can_be_employed_as = court_musician_court_position
		can_be_employed_as = court_jester_court_position
		can_be_employed_as = cupbearer_court_position
		can_be_employed_as = lady_in_waiting_court_position
		can_be_employed_as = chronicler_court_position
		can_be_employed_as = master_of_horse_court_position
		can_be_employed_as = bodyguard_court_position
		can_be_employed_as = champion_court_position
		can_be_employed_as = master_of_hunt_court_position
		can_be_employed_as = akolouthos_court_position
		can_be_employed_as = eryndar_court_position
		can_be_employed_as = royal_architect_court_position
		can_be_employed_as = seneschal_court_position
		can_be_employed_as = keeper_of_swans_court_position
		can_be_employed_as = court_gardener_court_position
		can_be_employed_as = food_taster_court_position
		can_be_employed_as = chief_eunuch_court_position
		can_be_employed_as = master_assassin_court_position
		can_be_employed_as = court_tutor_court_position
		can_be_employed_as = court_guru_court_position
		can_be_employed_as = high_almoner_court_position
		can_be_employed_as = court_physician_court_position
		can_be_employed_as = antiquarian_court_position
		can_be_employed_as = cave_hermit_court_position
		can_be_employed_as = court_scholar_court_position
		can_be_employed_as = court_brewmaster_court_position
		can_be_employed_as = court_astrologer_court_position
		can_be_employed_as = grand_preceptor_court_position
		can_be_employed_as = grand_mentor_court_position
		can_be_employed_as = grand_guardian_court_position
		can_be_employed_as = fire_dragon_engineer_court_position
		can_be_employed_as = keeper_of_the_harem_court_position
		can_be_employed_as = boyan_court_position
		can_be_employed_as = siege_engineer_court_position
		can_be_employed_as = yurtchi_court_position
		can_be_employed_as = cherbi_court_position
		can_be_employed_as = yeke_jarquchi_court_position
		can_be_employed_as = foreign_emissary_court_position
		can_be_employed_as = keeper_of_the_horses_court_position
	}
}